<!-- ... (HTML частина така ж, як була) ... -->

        <script>
            const words = <%- JSON.stringify(words) %>;
            let currentIndex = 0;
            // ... (renderCard functions) ...

            function processResult(status) {
                const word = words[currentIndex];
                const cardArea = document.getElementById('card-area');

                if (!cardArea.classList.contains('flipped')) flipCard();

                fetch('/study/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        userId: '<%= userId %>',  // <--- ВАЖЛИВО: ID передається тут
                        record_id: word.record_id,
                        word_id: word.word_id,
                        is_correct: status
                    })
                })
                .then(res => res.json())
                .then(data => {
                    const badge = document.getElementById('points-badge');
                    badge.innerText = `+${data.points_earned} XP`;
                    badge.style.opacity = '1';
                    setTimeout(() => badge.style.opacity = '0', 1000);
                    currentIndex++;
                    setTimeout(renderCard, 600);
                })
                .catch(err => console.error(err));
            }
            renderCard();
        </script>
<!-- ... -->