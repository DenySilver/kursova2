<%- include('partials/nav') %>

<div class="container py-5">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —ñ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-0">–í–∏–≤—á–µ–Ω–Ω—è: <%= lang.language_name %></h1>
            <p class="text-muted">–û–±–µ—Ä–∏ —Ä–µ–∂–∏–º —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∞–±–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</p>
        </div>
        <a href="/dashboard" class="btn btn-outline-secondary">‚¨Ö –ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É</a>
    </div>

    <!-- 1. –í–ï–†–•–ù–Ü–ô –ë–õ–û–ö: –®–≤–∏–¥–∫—ñ –¥—ñ—ó (–¢–µ—Å—Ç —ñ –ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è) -->
    <div class="row g-3 mb-5">
        <!-- –ö–∞—Ä—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è -->
        <div class="col-md-6">
            <div class="card bg-primary text-white shadow-sm h-100">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    <div>
                        <h4 class="mb-1">üß† –Ü–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</h4>
                        <% if (repetitionCount > 0) { %>
                            <span class="badge bg-light text-danger animate-pulse mb-2"><%= repetitionCount %> —Å–ª—ñ–≤ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</span>
                            <div class="small text-white-50">–ê–ª–≥–æ—Ä–∏—Ç–º –ø—ñ–¥—ñ–±—Ä–∞–≤ —Å–ª–æ–≤–∞, —è–∫—ñ –≤–∏ –º–æ–≥–ª–∏ –∑–∞–±—É—Ç–∏</div>
                        <% } else { %>
                            <div class="small text-white-50">–í—Å—ñ —Å–ª–æ–≤–∞ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –ø–æ–≤—Ç–æ—Ä–µ–Ω—ñ!</div>
                        <% } %>
                    </div>
                    <a href="/study/repetition/<%= lang.language_id %>" class="btn btn-light text-primary fw-bold px-4">–ü–æ—á–∞—Ç–∏</a>
                </div>
            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–∫–∞ —Ç–µ—Å—Ç—É -->
        <div class="col-md-6">
            <div class="card bg-warning text-dark shadow-sm h-100">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    <div>
                        <h4 class="mb-1">üìù –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h4>
                        <div class="small text-dark-50">–ü–µ—Ä–µ–≤—ñ—Ä —Å–≤–æ—ó –∑–Ω–∞–Ω–Ω—è —Ç–∞ –∑–∞—Ä–æ–±–∏ –±–∞–ª–∏ –¥–ª—è –ª—ñ–≥–∏</div>
                    </div>
                    <a href="/study/test/<%= lang.language_id %>" class="btn btn-dark fw-bold px-4">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</a>
                </div>
            </div>
        </div>
    </div>

    <hr class="mb-4">

    <!-- 2. –ù–ò–ñ–ù–Ü–ô –ë–õ–û–ö: –ö–∞—Ç–∞–ª–æ–≥ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π -->
    
    <!-- –ü–∞–Ω–µ–ª—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ (–ü–æ—à—É–∫ —ñ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è) -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <h3 class="mb-0">üìÇ –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Å–ª—ñ–≤</h3>
        
        <div class="d-flex gap-2">
            <input type="text" id="searchInput" class="form-control" placeholder="üîç –ü–æ—à—É–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó..." style="width: 200px;">
            <select id="sortSelect" class="form-select" style="width: 200px;">
                <option value="name">–ó–∞ –Ω–∞–∑–≤–æ—é (–ê-–Ø)</option>
                <option value="difficulty">–ó–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é</option>
                <option value="count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª—ñ–≤</option>
            </select>
        </div>
    </div>

    <!-- –°—ñ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π -->
    <div class="row g-4" id="categoriesContainer">
        <% categories.forEach(cat => { 
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å—Ç–∏–ª—ñ –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
            let colorClass = 'border-success'; 
            let badgeClass = 'bg-success';
            let icon = 'üå±'; // Easy

            if (cat.difficulty_level === 'Medium') {
                colorClass = 'border-warning';
                badgeClass = 'bg-warning text-dark';
                icon = '‚ö°';
            } else if (cat.difficulty_level === 'Hard') {
                colorClass = 'border-danger';
                badgeClass = 'bg-danger';
                icon = 'üî•';
            }
        %>
            <div class="col-md-4 category-item" 
                 data-name="<%= cat.category_name.toLowerCase() %>" 
                 data-difficulty="<%= cat.difficulty_level %>"
                 data-count="<%= cat.word_count %>">
                 
                <a href="/study/cards/<%= lang.language_id %>/cat/<%= cat.category_id %>" class="text-decoration-none text-dark">
                    <div class="card h-100 shadow-sm hover-effect border-top border-4 <%= colorClass %>">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between mb-3">
                                <span class="fs-4"><%= icon %></span>
                                <span class="badge <%= badgeClass %> rounded-pill"><%= cat.difficulty_level %></span>
                            </div>
                            
                            <h3 class="card-title fw-bold mb-2"><%= cat.category_name %></h3>
                            <p class="text-muted mb-4"><%= cat.word_count %> —Å–ª—ñ–≤</p>

                            <button class="btn btn-outline-dark w-100 rounded-pill">–í—á–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏</button>
                        </div>
                    </div>
                </a>
            </div>
        <% }) %>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è "–Ω–∞ –ª—å–æ—Ç—É" -->
<script>
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const container = document.getElementById('categoriesContainer');
    const items = Array.from(document.querySelectorAll('.category-item'));

    // –ü–æ—à—É–∫
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        items.forEach(item => {
            const name = item.dataset.name;
            if (name.includes(term)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });

    // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    sortSelect.addEventListener('change', (e) => {
        const type = e.target.value;
        const sorted = items.sort((a, b) => {
            if (type === 'name') {
                return a.dataset.name.localeCompare(b.dataset.name);
            } else if (type === 'count') {
                // –í—ñ–¥ –±—ñ–ª—å—à–æ–≥–æ –¥–æ –º–µ–Ω—à–æ–≥–æ
                return parseInt(b.dataset.count) - parseInt(a.dataset.count);
            } else if (type === 'difficulty') {
                const map = { 'Easy': 1, 'Medium': 2, 'Hard': 3 };
                return map[a.dataset.difficulty] - map[b.dataset.difficulty];
            }
        });
        
        // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        container.innerHTML = '';
        sorted.forEach(item => container.appendChild(item));
    });
</script>

<style>
    /* –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è */
    .animate-pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
</style>