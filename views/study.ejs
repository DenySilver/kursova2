<!DOCTYPE html>
<html lang="uk">
<head>
    <title>–ù–∞–≤—á–∞–Ω–Ω—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .flip-card { perspective: 1000px; height: 300px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 1px solid #ddd; border-radius: 12px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .flip-card-back { transform: rotateY(180deg); background: #f0f8ff; }
    </style>
</head>
<body class="container py-5 text-center">
    <% if(words.length === 0) { %>
        <div class="alert alert-success mt-5">
            <h1>üéâ –ß—É–¥–æ–≤–æ!</h1>
            <p>–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç —Å–ª—ñ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –Ω–µ–º–∞—î.</p>
            <a href="/user/<%= user.user_id %>" class="btn btn-primary">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ –ø—Ä–æ—Ñ—ñ–ª—å</a>
        </div>
    <% } else { %>
        <p>–°–ª—ñ–≤ –∑–∞–ª–∏—à–∏–ª–æ—Å—å: <%= words.length %></p>
        
        <div class="d-flex justify-content-center mb-4">
            <div class="flip-card w-100" style="max-width: 400px;" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <% if(words[0].image_url) { %><img src="<%= words[0].image_url %>" height="80" class="mb-3"><% } %>
                        <h1 class="display-4 fw-bold"><%= words[0].original %></h1>
                        <p class="text-muted small">–ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–±–µ</p>
                    </div>
                    <div class="flip-card-back">
                        <h1 class="text-success"><%= words[0].translation %></h1>
                        <p class="fst-italic">"<%= words[0].example_sentence %>"</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center gap-3">
            <button class="btn btn-danger px-4 py-2" onclick="sendResult('no')">–ù–µ –∑–Ω–∞—é üòû</button>
            <button class="btn btn-success px-4 py-2" onclick="sendResult('yes')">–ó–Ω–∞—é! üòé</button>
        </div>

        <script>
            function sendResult(status) {
                const data = {
                    user_id: '<%= user.user_id %>',
                    record_id: '<%= words[0].record_id %>',
                    is_correct: status
                };
                
                fetch('/study/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                })
                .then(res => res.json())
                .then(response => {
                    alert(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ +${response.points_earned} –±–∞–ª—ñ–≤!`);
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Å–ª–æ–≤–∞
                })
                .catch(err => console.error(err));
            }
        </script>
    <% } %>
</body>
</html>